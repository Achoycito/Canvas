<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pruebas Canvas</title>
    <style type="text/css">
        canvas{
            background-color: rgb(230,230,255);
            margin: 20px;
        }
    </style>
</head>
<body>

    <canvas id="canvasChido" width="800" height="800">
        Tu navegador no soporta Canvas pero aquí hay un Canvas bonito
    </canvas>

    <script type="text/javascript">
        var canvas = null;
        var ctx = null;
        
        var pause = false;
        var colorPared = "brown";
        
        var player1 = null;
        var direccion = null;
        var velMov = 2;

        var paredes = [];

        var indiana = new Image();
        var diamante = new Image();
        var pickupsound = new Audio();
        
        function start(){
            canvas = document.getElementById("canvasChido");
            ctx = canvas.getContext("2d");

            player1 = new Cuadro(8, 8, "objeto", null, null);
            crearParedes();
            indiana.src = "img/pato.png";
            // diamante.src = "img/diamond.png";
            // pickupsound.src = "sound/bonk.mp3";

            pintarCuadrado();
        }

        window.requestAnimationFrame = (function () {
        return window.requestAnimationFrame ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
            function (callback) {
                window.setTimeout(callback, 17);
            };
        }());

        document.addEventListener("load", start(), false);

        function pintarCuadrado(){
            window.requestAnimationFrame(pintarCuadrado);
            ctx.fillStyle = "rgb(230,230,255)";
            ctx.fillRect(0, 0, 10000,10000);

            ctx.font = "30px Calibri";
            ctx.fillStyle = "rgba(255,60,0,1)";
            // ctx.fillText("Puntuación: "+score, 10, 30);
            ctx.drawImage(indiana, player1.x, player1.y);
            for (let i = 0; i < paredes.length; i++) {
                paredes[i].pintar(ctx);
            }
            if(pause){
                ctx.fillStyle = "rgba(0,0,0,0.5)";
                ctx.fillRect(0,0,2000,2000);

                ctx.fillStyle = "white";
                ctx.fillText("P A U S A", 10,400);
            }
            else{
                update();
            }
            
        }

        function update(){
            switch (direccion) {
                case "derecha":
                    if(player1.x!=776)
                        player1.x+=velMov;
                    break;
                case "izquierda":
                    if(player1.x!=0)
                        player1.x-=velMov;
                    break;
                case "arriba":
                    if(player1.y!=0)
                        player1.y-=velMov;
                    break;
                case "abajo":
                    if(player1.y!=776)
                        player1.y+=velMov;
                    break;
                default:
                    break;
            }
            for (let i = 0; i < paredes.length; i++) {
                if(player1.se_tocan(paredes[i])){
                    switch (direccion) {
                        case "derecha":
                            player1.x-=velMov;
                            break;
                        case "izquierda":
                            player1.x+=velMov;
                            break;
                        case "arriba":
                            player1.y+=velMov;
                            break;
                        case "abajo":
                            player1.y-=velMov;
                            break;
                        default:
                            break;
                    }
                }
            }
        }

        function Cuadro(x, y, tipo, orient, largo){
            this.tipo = tipo;
            if(tipo == "objeto"){
                this.x = x;
                this.y = y;
                this.w = 24;
                this.h = 24;
            }
            else if(tipo == "pared"){
                this.x = x*40;
                this.y = y*40;
                if(orient == "v"){
                    this.w = 2;
                    this.h = largo*40;
                }
                else if(orient == "h"){
                    this.w = largo*40;
                    this.h = 2;
                }
            }

            this.se_tocan = function (target) { 
                if(this.x < target.x + target.w &&
                this.x + this.w > target.x && 
                this.y < target.y + target.h && 
                this.y + this.h > target.y){
                    return true;
                    console.log("Llamado de emergencia nueve uno uno")
                }
            };

            this.pintar = function(ctx){
                ctx.fillRect(this.x, this.y, this.w, this.h);
                ctx.strokeRect(this.x, this.y, this.w, this.h);
            }
        }

        document.addEventListener("keydown", function(e){
            console.log(e.key);
            if(e.key == "w" || e.key =="ArrowUp"){
                // ultraY-=15;
                direccion = "arriba";
            }
            if(e.key == "s" || e.key =="ArrowDown"){
                // ultraY+=15;
                direccion = "abajo";
            }
            if(e.key == "a" || e.key =="ArrowLeft"){
                // ultraX-=15;
                direccion = "izquierda";
            }
            if(e.key == "d" || e.key =="ArrowRight"){
                // ultraX+=15;
                direccion = "derecha";
            }
            if(e.key == " "){
                pause = (pause) ? false : true;
            }
        });

        canvas.addEventListener("click", function(e){
            alert(e.offsetX + ", " + e.offsetY);
        });

        function crearParedes(){
            paredes.push(new Cuadro(1,0,"pared","v",1));
            paredes.push(new Cuadro(6,0,"pared","v",4));
            paredes.push(new Cuadro(11,0,"pared","v",1));
            paredes.push(new Cuadro(17,0,"pared","v",1));
            paredes.push(new Cuadro(19,0,"pared","v",1));
            
            paredes.push(new Cuadro(1,1,"pared","h",2));
            paredes.push(new Cuadro(2,1,"pared","v",2));
            paredes.push(new Cuadro(4,1,"pared","v",1));
            paredes.push(new Cuadro(4,1,"pared","h",1));
            paredes.push(new Cuadro(5,1,"pared","v",2));
            paredes.push(new Cuadro(7,1,"pared","v",1));
            paredes.push(new Cuadro(8,1,"pared","h",2));
            paredes.push(new Cuadro(9,1,"pared","v",2));
            paredes.push(new Cuadro(10,1,"pared","v",3));
            paredes.push(new Cuadro(11,1,"pared","h",2));
            paredes.push(new Cuadro(13,1,"pared","v",4));
            paredes.push(new Cuadro(14,1,"pared","h",2));
            paredes.push(new Cuadro(16,1,"pared","v",1));
            paredes.push(new Cuadro(18,1,"pared","v",3));
            
            paredes.push(new Cuadro(0,2,"pared","h",1));
            paredes.push(new Cuadro(1,2,"pared","v",2));
            paredes.push(new Cuadro(3,2,"pared","v",2));
            paredes.push(new Cuadro(3,2,"pared","h",1));
            paredes.push(new Cuadro(6,2,"pared","v",2));
            paredes.push(new Cuadro(6,2,"pared","h",2));
            paredes.push(new Cuadro(10,2,"pared","v",2));
            paredes.push(new Cuadro(10,2,"pared","h",2));
            paredes.push(new Cuadro(14,2,"pared","h",1));
            paredes.push(new Cuadro(15,2,"pared","v",1));
            paredes.push(new Cuadro(16,2,"pared","h",3));
            paredes.push(new Cuadro(19,2,"pared","v",1));
            
            paredes.push(new Cuadro(4,3,"pared","h",1));
            paredes.push(new Cuadro(4,3,"pared","v",4));
            paredes.push(new Cuadro(7,3,"pared","h",2));
            paredes.push(new Cuadro(8,3,"pared","v",3));
            paredes.push(new Cuadro(11,3,"pared","h",2));
            paredes.push(new Cuadro(14,3,"pared","h",3));
            paredes.push(new Cuadro(14,3,"pared","v",2));
            
            paredes.push(new Cuadro(2,4,"pared","h",1));
            paredes.push(new Cuadro(5,4,"pared","h",1));
            paredes.push(new Cuadro(5,4,"pared","v",1));
            paredes.push(new Cuadro(7,4,"pared","v",1));
            paredes.push(new Cuadro(9,4,"pared","v",2));
            paredes.push(new Cuadro(10,4,"pared","h",2));
            paredes.push(new Cuadro(11,4,"pared","v",3));
            paredes.push(new Cuadro(15,4,"pared","h",4));
            paredes.push(new Cuadro(19,4,"pared","v",1));
            
            paredes.push(new Cuadro(0,5,"pared","h",2));
            paredes.push(new Cuadro(2,5,"pared","v",1));
            paredes.push(new Cuadro(3,5,"pared","v",1));
            paredes.push(new Cuadro(5,5,"pared","h",2));
            paredes.push(new Cuadro(9,5,"pared","h",1));
            paredes.push(new Cuadro(12,5,"pared","h",1));
            paredes.push(new Cuadro(12,5,"pared","v",1));
            paredes.push(new Cuadro(14,5,"pared","h",4));
            paredes.push(new Cuadro(15,5,"pared","v",2));
            paredes.push(new Cuadro(18,5,"pared","v",2));
            paredes.push(new Cuadro(19,5,"pared","h",1));
            
            paredes.push(new Cuadro(1,6,"pared","v",1));
            paredes.push(new Cuadro(2,6,"pared","h",1));
            paredes.push(new Cuadro(4,6,"pared","h",5));
            paredes.push(new Cuadro(4,6,"pared","v",1));
            paredes.push(new Cuadro(6,6,"pared","v",1));
            paredes.push(new Cuadro(10,6,"pared","v",1));
            paredes.push(new Cuadro(12,6,"pared","h",2));
            paredes.push(new Cuadro(13,6,"pared","v",2));
            paredes.push(new Cuadro(15,6,"pared","h",2));
            paredes.push(new Cuadro(18,6,"pared","h",1));
            
            paredes.push(new Cuadro(1,7,"pared","h",2));
            paredes.push(new Cuadro(3,7,"pared","v",2));
            paredes.push(new Cuadro(5,7,"pared","h",1));
            paredes.push(new Cuadro(5,7,"pared","v",2));
            paredes.push(new Cuadro(7,7,"pared","h",1));
            paredes.push(new Cuadro(7,7,"pared","v",2));
            paredes.push(new Cuadro(9,7,"pared","h",3));
            paredes.push(new Cuadro(9,7,"pared","v",1));
            paredes.push(new Cuadro(12,7,"pared","v",2));
            paredes.push(new Cuadro(12,7,"pared","v",2));
            paredes.push(new Cuadro(14,7,"pared","h",1));
            paredes.push(new Cuadro(16,7,"pared","h",2));
            paredes.push(new Cuadro(16,7,"pared","v",2));
            paredes.push(new Cuadro(19,7,"pared","v",1));
            
            paredes.push(new Cuadro(1,8,"pared","h",1));
            paredes.push(new Cuadro(1,8,"pared","v",1));
            paredes.push(new Cuadro(3,8,"pared","h",1));
            paredes.push(new Cuadro(6,8,"pared","h",1));
            paredes.push(new Cuadro(6,8,"pared","v",2));
            paredes.push(new Cuadro(8,8,"pared","h",1));
            paredes.push(new Cuadro(10,8,"pared","h",1));
            paredes.push(new Cuadro(10,8,"pared","v",1));
            paredes.push(new Cuadro(11,8,"pared","v",3));
            paredes.push(new Cuadro(13,8,"pared","h",2));
            paredes.push(new Cuadro(14,8,"pared","v",1));
            paredes.push(new Cuadro(17,8,"pared","h",3));
            
            paredes.push(new Cuadro(0,9,"pared","h",1));
            paredes.push(new Cuadro(3,9,"pared","h",2));
            paredes.push(new Cuadro(2,9,"pared","v",4));
            paredes.push(new Cuadro(4,9,"pared","v",1));
            paredes.push(new Cuadro(7,9,"pared","h",3));
            paredes.push(new Cuadro(12,9,"pared","h",1));
            paredes.push(new Cuadro(13,9,"pared","v",1));
            paredes.push(new Cuadro(14,9,"pared","h",3));
            paredes.push(new Cuadro(17,9,"pared","v",2));
            paredes.push(new Cuadro(18,9,"pared","h",1));
            paredes.push(new Cuadro(18,9,"pared","v",3));
            
            paredes.push(new Cuadro(1,10,"pared","h",1));
            paredes.push(new Cuadro(3,10,"pared","v",2));
            paredes.push(new Cuadro(5,10,"pared","h",1));
            paredes.push(new Cuadro(5,10,"pared","v",1));
            paredes.push(new Cuadro(7,10,"pared","h",3));
            paredes.push(new Cuadro(8,10,"pared","v",1));
            paredes.push(new Cuadro(10,10,"pared","v",2));
            paredes.push(new Cuadro(10,10,"pared","v",1));
            paredes.push(new Cuadro(11,10,"pared","h",1));
            paredes.push(new Cuadro(12,10,"pared","v",3));
            paredes.push(new Cuadro(13,10,"pared","h",3));
            paredes.push(new Cuadro(16,10,"pared","v",2));
            paredes.push(new Cuadro(19,10,"pared","h",1));
            
            paredes.push(new Cuadro(1,11,"pared","v",2));
            paredes.push(new Cuadro(3,11,"pared","h",2));
            paredes.push(new Cuadro(6,11,"pared","h",1));
            paredes.push(new Cuadro(7,11,"pared","v",2));
            paredes.push(new Cuadro(9,11,"pared","v",2));
            paredes.push(new Cuadro(12,11,"pared","h",3));
            paredes.push(new Cuadro(15,11,"pared","v",1));
            paredes.push(new Cuadro(17,11,"pared","h",2));
            
            paredes.push(new Cuadro(3,12,"pared","h",1));
            paredes.push(new Cuadro(4,12,"pared","v",1));
            paredes.push(new Cuadro(5,12,"pared","h",2));
            paredes.push(new Cuadro(5,12,"pared","v",1));
            paredes.push(new Cuadro(8,12,"pared","h",1));
            paredes.push(new Cuadro(10,12,"pared","h",1));
            paredes.push(new Cuadro(11,12,"pared","v",3));
            paredes.push(new Cuadro(13,12,"pared","h",1));
            paredes.push(new Cuadro(13,12,"pared","v",2));
            paredes.push(new Cuadro(16,12,"pared","h",1));
            paredes.push(new Cuadro(17,12,"pared","v",1));
            paredes.push(new Cuadro(19,12,"pared","v",1));
            
            paredes.push(new Cuadro(0,13,"pared","h",1));
            paredes.push(new Cuadro(2,13,"pared","h",2));
            paredes.push(new Cuadro(3,13,"pared","v",2));
            paredes.push(new Cuadro(4,13,"pared","h",1));
            paredes.push(new Cuadro(6,13,"pared","v",1));
            paredes.push(new Cuadro(7,13,"pared","h",3));
            paredes.push(new Cuadro(11,13,"pared","h",1));
            paredes.push(new Cuadro(14,13,"pared","h",5));
            paredes.push(new Cuadro(15,13,"pared","v",3));
            
            paredes.push(new Cuadro(1,14,"pared","h",1));
            paredes.push(new Cuadro(1,14,"pared","v",1));
            paredes.push(new Cuadro(3,14,"pared","h",7));
            paredes.push(new Cuadro(9,14,"pared","v",1));
            paredes.push(new Cuadro(12,14,"pared","h",2));
            paredes.push(new Cuadro(12,14,"pared","v",4));
            paredes.push(new Cuadro(14,14,"pared","v",1));
            paredes.push(new Cuadro(16,14,"pared","h",4));
            paredes.push(new Cuadro(16,14,"pared","v",1));
            paredes.push(new Cuadro(18,14,"pared","v",2));
            
            paredes.push(new Cuadro(1,15,"pared","h",2));
            paredes.push(new Cuadro(4,15,"pared","h",3));
            paredes.push(new Cuadro(4,15,"pared","v",2));
            paredes.push(new Cuadro(5,15,"pared","v",1));
            paredes.push(new Cuadro(7,15,"pared","v",3));
            paredes.push(new Cuadro(8,15,"pared","h",1));
            paredes.push(new Cuadro(8,15,"pared","v",1));
            paredes.push(new Cuadro(10,15,"pared","h",1));
            paredes.push(new Cuadro(10,15,"pared","v",2));
            paredes.push(new Cuadro(13,15,"pared","h",1));
            paredes.push(new Cuadro(13,15,"pared","v",2));
            paredes.push(new Cuadro(17,15,"pared","v",2));
            paredes.push(new Cuadro(19,15,"pared","v",1));
            
            paredes.push(new Cuadro(1,16,"pared","h",3));
            paredes.push(new Cuadro(2,16,"pared","v",3));
            paredes.push(new Cuadro(6,16,"pared","v",1));
            paredes.push(new Cuadro(9,16,"pared","h",1));
            paredes.push(new Cuadro(9,16,"pared","v",2));
            paredes.push(new Cuadro(11,16,"pared","h",1));
            paredes.push(new Cuadro(14,16,"pared","h",3));
            paredes.push(new Cuadro(14,16,"pared","v",1));
            paredes.push(new Cuadro(18,16,"pared","h",1));
            
            paredes.push(new Cuadro(0,17,"pared","h",1));
            paredes.push(new Cuadro(3,17,"pared","v",1));
            paredes.push(new Cuadro(4,17,"pared","h",2));
            paredes.push(new Cuadro(7,17,"pared","h",2));
            paredes.push(new Cuadro(10,17,"pared","h",1));
            paredes.push(new Cuadro(11,17,"pared","v",1));
            paredes.push(new Cuadro(14,17,"pared","h",1));
            paredes.push(new Cuadro(16,17,"pared","v",1));
            paredes.push(new Cuadro(17,17,"pared","h",2));
            paredes.push(new Cuadro(18,17,"pared","v",1));
            
            paredes.push(new Cuadro(1,18,"pared","h",1));
            paredes.push(new Cuadro(3,18,"pared","h",3));
            paredes.push(new Cuadro(6,18,"pared","v",2));
            paredes.push(new Cuadro(8,18,"pared","v",1));
            paredes.push(new Cuadro(9,18,"pared","h",1));
            paredes.push(new Cuadro(10,18,"pared","v",1));
            paredes.push(new Cuadro(12,18,"pared","h",6));
            paredes.push(new Cuadro(13,18,"pared","v",1));
            paredes.push(new Cuadro(15,18,"pared","v",1));
            paredes.push(new Cuadro(19,18,"pared","h",1));
            paredes.push(new Cuadro(19,18,"pared","v",1));
            
            paredes.push(new Cuadro(0,19,"pared","h",1));
            paredes.push(new Cuadro(2,19,"pared","h",3));
            paredes.push(new Cuadro(6,19,"pared","h",4));
            paredes.push(new Cuadro(6,19,"pared","v",1));
            paredes.push(new Cuadro(11,19,"pared","h",1));
            paredes.push(new Cuadro(12,19,"pared","v",1));
            paredes.push(new Cuadro(14,19,"pared","v",1));
            paredes.push(new Cuadro(16,19,"pared","h",3));
        }
</script>
</body>
</html>