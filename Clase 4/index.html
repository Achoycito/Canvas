<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pruebas Canvas</title>
    <style type="text/css">
        canvas{
            background-color: rgb(230,230,255);
            margin: 20px;
        }
    </style>
</head>
<body>

    <canvas id="canvasChido" width="1400" height="880">
        Tu navegador no soporta Canvas pero aquí hay un Canvas bonito
    </canvas>

    <script type="text/javascript">
        var canvas = null;
        var ctx = null;
        var pressed = false;
        var r, g, b;
        var player1 = null;
        var player2 = null;
        var score = 0;
        var velMov = 10;
        var direccion = "derecha";
        
        function start(){
            canvas = document.getElementById("canvasChido");
            ctx = canvas.getContext("2d");

            player1 = new cuadro(0, 50, 100, 100, "blue");
            player2 = new cuadro(getRandomInt(1200)+50, getRandomInt(700)+50, 50, 50, "yellow");

            pintarCuadrado();
        }

        window.requestAnimationFrame = (function () {
        return window.requestAnimationFrame ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
            function (callback) {
                window.setTimeout(callback, 17);
            };
        }());

        document.addEventListener("load", start(), false);

        function pintarCuadrado(){
            window.requestAnimationFrame(pintarCuadrado);
            ctx.fillStyle = "rgb(230,230,255)";
            ctx.fillRect(0, 0, 10000,10000);

            ctx.font = "30px Calibri";
            ctx.fillStyle = "rgba(255,60,0,1)";
            ctx.fillText("Puntuación: "+score, 10, 30);
            player1.pintar(ctx);
            player2.pintar(ctx);
            
            switch (direccion) {
                case "derecha":
                    player1.x+=velMov;
                    if(player1.x>=1400){
                        player1.x=-99;
                    }
                    break;
                case "izquierda":
                    player1.x-=velMov;
                    if(player1.x<=-99){
                        player1.x=1400;
                    }
                    break;
                case "arriba":
                    player1.y-=velMov;
                    if(player1.y<=-99){
                        player1.y=880;
                    }
                    break;
                case "abajo":
                    player1.y+=velMov;
                    if(player1.y>=880){
                        player1.y=-99;
                    }
                    break;
                default:
                    break;
            }
            if (player1.se_tocan(player2)) {
                player2.x = getRandomInt(1200)+50;
                player2.y = getRandomInt(700)+50;
                score+=5;
                velMov+=5;
            }
        }


        function cuadro(x,y,w,h,c){
            this.x = x;
            this.y = y;
            this.w = w;
            this.h = h;
            this.c = c;

            this.se_tocan = function (target) { 
                if(this.x < target.x + target.w &&
                this.x + this.w > target.x && 
                this.y < target.y + target.h && 
                this.y + this.h > target.y){
                    return true;
                    console.log("Llamado de emergencia nueve uno uno")
                }
            };

            this.pintar = function(ctx){
                ctx.fillStyle = this.c;
                ctx.fillRect(this.x, this.y, this.w, this.h);
                ctx.strokeRect(this.x, this.y, this.w, this.h);
            }
        }

        document.addEventListener("keydown", function(e){
            if(e.key == "w" || e.key =="ArrowUp"){
                // ultraY-=15;
                direccion = "arriba";
            }
            if(e.key == "s" || e.key =="ArrowDown"){
                // ultraY+=15;
                direccion = "abajo";
            }
            if(e.key == "a" || e.key =="ArrowLeft"){
                // ultraX-=15;
                direccion = "izquierda";
            }
            if(e.key == "d" || e.key =="ArrowRight"){
                // ultraX+=15;
                direccion = "derecha";
            }
        });

        function getRandomInt(limite){
            return Math.floor(Math.random() * limite);
        }
        
        // canvas.addEventListener("mouseover", function(e){
        //     generateRandomColor();
        // })
        
        // canvas.addEventListener("mousedown", function(e){
        //     pressed = true;
        // });

        function generateRandomColor() {
            r = Math.floor(Math.random() * 256);
            g = Math.floor(Math.random() * 256);
            b = Math.floor(Math.random() * 256);
        }

        

</script>
</body>
</html>